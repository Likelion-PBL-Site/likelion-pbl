# 세션 진행 상황 자동 저장 기능 (/checkpoint)

> 작성일: 2026-01-19
> 관련 파일: `.claude/commands/checkpoint.md`, `.claude/session-progress.md`, `CLAUDE.md`
> 태그: #feature #dx #ai-collaboration #session-management

## 배경 및 문제 상황

Claude Code와 작업 중 세션이 끊기면 진행 중이던 컨텍스트가 모두 사라지는 문제가 있었다.

### 증상
- 세션 종료 시 진행 중이던 트러블슈팅 작업 내용 소실
- 새 세션에서 처음부터 컨텍스트를 다시 설명해야 함
- 복잡한 작업의 중간 상태를 복구할 방법 없음

### 실제 사례
> "아 나 지금 그 url 트러블 슈팅하던거 사라졌네..하"
- 이전 세션에서 Notion 이미지 URL 만료 문제를 다루고 있었음
- 세션이 끊기면서 "온디맨드 방식으로 하기로 했다"는 결정만 기억

---

## AI 협업 흐름 (Prompting Log)

### 1단계: 문제 정의
**User Prompt:**
> "앞으로 이렇게 또 내가 세션을 중간에 종료해버리면 트러블슈팅이 끊기잖아.. 이걸 계속 자동으로 저장하고 기록하게 할 수 없을까?"

**AI Response:**
- 문제 인식: 세션 컨텍스트 소실 문제
- Claude Code의 `.claude` 폴더 구조 분석
- hooks, commands 등 확장 가능한 기능 탐색

### 2단계: 해결 방안 탐색
**User Prompt:**
(선택지 제시에 대한 응답)

**AI Response:**
세 가지 옵션 제시:
1. `/checkpoint` 명령어 (추천) - 수동으로 진행 상황 저장
2. 자동 저장 (hooks) - 툴 호출 시마다 자동 기록 (오버헤드 가능)
3. 둘 다 - 수동 명령어 + 주요 작업 완료 시 자동 저장

### 3단계: 구현 결정
**User Prompt:**
> "둘 다"

**AI Response:**
- `/checkpoint` 명령어 생성
- `session-progress.md` 파일 포맷 정의
- CLAUDE.md에 자동 저장 트리거 조건 문서화

### 4단계: 검증 및 완료
**AI Response:**
- 명령어 파일 생성 완료
- 현재 세션 상태를 예시로 저장
- CLAUDE.md 업데이트 (명령어 설명, 디렉토리 구조)

---

## 기술적 분석

### 원인/배경 분석

1. **Claude Code 세션의 특성**
   - 각 세션은 독립적이며 이전 대화 히스토리 없음
   - 컨텍스트는 현재 세션 내에서만 유효
   - CLAUDE.md를 통해 프로젝트 컨텍스트는 유지되나, 진행 중인 작업 상태는 저장되지 않음

2. **기존 해결책의 한계**
   - 트러블슈팅 문서: 완료된 작업만 기록, 진행 중인 작업은 대상 아님
   - CLAUDE.md: 프로젝트 구조/가이드 용도, 세션 상태 저장 부적합

### 해결 접근 방식

**파일 기반 세션 상태 저장:**
- `.claude/session-progress.md` 파일에 진행 상황 저장
- 구조화된 마크다운 포맷으로 기계/사람 모두 읽기 쉽게
- 새 세션 시작 시 이 파일을 확인하여 이전 컨텍스트 복구

---

## 구현 내용

### 생성/수정된 파일
| 파일 | 변경 내용 |
|------|----------|
| `.claude/commands/checkpoint.md` | /checkpoint 명령어 정의 |
| `.claude/session-progress.md` | 세션 진행 상황 저장 파일 |
| `CLAUDE.md` | 명령어 설명 및 자동 저장 가이드 추가 |

### 핵심 코드

**session-progress.md 포맷:**
```markdown
# 세션 진행 상황

> 마지막 업데이트: YYYY-MM-DD HH:MM

## 현재 작업 중인 태스크
[현재 진행 중인 작업 설명]

## 진행 상황
- [x] 완료된 단계
- [ ] 진행 중인 단계
- [ ] 남은 단계

## 핵심 컨텍스트
- 문제/목표: [간단한 설명]
- 선택한 접근 방식: [방식 설명]
- 관련 파일: [파일 경로들]

## 다음 단계
[세션 재개 시 해야 할 일]

## 대화 요약
[중요한 의사결정 포인트 요약]
```

**자동 저장 트리거 조건 (CLAUDE.md에 명시):**
- 큰 작업 단위 완료 시
- 의사결정 포인트 도달 시
- 여러 파일 수정 완료 시
- "잠깐", "나중에" 등 작업 중단 신호 시

---

## 검증

### 테스트 방법
1. 현재 세션 상태로 `session-progress.md` 생성
2. 실제 진행 중인 작업 내용이 올바르게 저장되는지 확인

### 결과
```markdown
## 현재 작업 중인 태스크
Notion 이미지 URL 만료 문제 - 온디맨드 갱신 방식 구현

## 진행 상황
- [x] 문제 파악: JSON 캐시에 저장된 이미지 URL 만료 시 403 에러
- [x] 기존 온디맨드 구현 확인 (이미 구현되어 있었음)
- [x] 트러블슈팅 문서 작성 (004-notion-image-url-on-demand.md)
- [x] /checkpoint 명령어 생성
...
```

---

## 프롬프팅 인사이트

### 효과적이었던 프롬프트 패턴
- **문제 중심 질문**: "이걸 계속 자동으로 저장하고 기록하게 할 수 없을까?"
  - 구체적인 해결책이 아닌 문제를 제시 → AI가 여러 옵션 탐색
- **간결한 선택**: "둘 다" → 빠른 의사결정

### 개선할 수 있는 점
- 세션 시작 시 자동으로 `session-progress.md` 확인하도록 CLAUDE.md에 더 명시적으로 작성

### AI 협업 팁
- Claude Code는 `.claude/` 폴더의 commands, hooks를 자동으로 인식
- 커스텀 명령어로 반복 작업 자동화 가능
- 파일 기반 상태 저장이 세션 간 컨텍스트 유지에 효과적

---

## 교훈

### 기술적 교훈
1. **파일 기반 상태 관리**: 세션 독립적인 환경에서 파일이 가장 신뢰할 수 있는 상태 저장소
2. **구조화된 포맷**: 마크다운 체크리스트로 진행 상황을 시각적으로 표현
3. **명시적 트리거**: 자동 저장 조건을 문서화하여 일관된 동작 보장

### AI 협업 교훈
1. **DX(Developer Experience) 개선도 요청 가능**: 코드 작성뿐 아니라 협업 워크플로우 자체를 개선할 수 있음
2. **점진적 자동화**: 수동 명령어로 시작 → 사용 패턴 파악 → 자동화 확대
3. **메타 레벨 협업**: AI와의 협업 방식 자체를 AI와 함께 개선

---

## 사용 방법 요약

### 세션 종료 전
```
/checkpoint
```

### 새 세션 시작 시
```
이전 작업 이어서 해줘
```
또는 Claude가 자동으로 `.claude/session-progress.md` 확인 후 제안

### 관련 문서
- [CLAUDE.md](../../CLAUDE.md) - 세션 진행 상황 관리 섹션
- [004-notion-image-url-on-demand.md](./004-notion-image-url-on-demand.md) - 이번 세션에서 복구한 작업
